 cat("\nTests for 'CreateEigenfncts'")

myEps <- .Machine$double.eps;

test_that(" basic 1-2-3 number of eigenfunctions matches MATLAB output ", { 
  expect_equal(CreateEigenfncts(c(0,1),1,1), matrix( c(-1.414213562373095,    -1.414213562373095), nrow=1), tolerance = 2*myEps,scale = 1)
  expect_equal(CreateEigenfncts(c(0,1),1,2), matrix( c(-1.414213562373095, 0, -1.414213562373095, 0), nrow=2), tolerance = 2*myEps,scale = 1)
  expect_equal(CreateEigenfncts(c(0,1),1,3), matrix( c(-1.414213562373095, 0, -1.414213562373095,
                                           -1.414213562373095, 0, -1.414213562373095), nrow=3), tolerance = 2*myEps,scale = 1)
})

test_that(" small magnitude 't' vector matches MATLAB output ", { 
  expect_equal(CreateEigenfncts(c(0,1,3)*(10^-14),1,1), matrix( c(-1.414213562373095, -1.414213562373095,
                                                      -1.414213562373095), nrow=1), tolerance = 2*myEps,scale = 1) 
  expect_equal(CreateEigenfncts(c(0,1,3)*(10^-14),1,2), matrix( c(-1.414213562373095, 0, -1.414213562373095, 0.000000000000089,
                                                      -1.414213562373095, 0.000000000000267), nrow=2), tolerance = 2*myEps,scale = 1) 
  expect_equal(CreateEigenfncts(c(0,1,3)*(10^-14),1,3), matrix( c(-1.414213562373095, 0, -1.414213562373095, -1.414213562373095,
                                                       0.000000000000089, -1.414213562373095,-1.414213562373095, 
                                                       0.000000000000267, -1.414213562373095), ncol=3), tolerance = 2*myEps,scale = 1) 
  expect_equal(CreateEigenfncts(c(0,1,3)*(10^-14),3,1), matrix( c(-0.816496580927726, -0.816496580927726,
                                                      -0.816496580927726), nrow=1), tolerance = 2*myEps,scale = 1)  
  expect_equal(CreateEigenfncts(c(0,1,3)*(10^-14),3,2), matrix( c(-0.816496580927726, 0, -0.816496580927726,   1.71006e-14,
                                                      -0.816496580927726, 5.13019e-14), nrow=2), tolerance = 2*myEps,scale = 1) 
  expect_equal(CreateEigenfncts(c(0,1,3)*(10^-14),3,3), matrix( c(-0.816496580927726, 0, -0.816496580927726, -0.816496580927726,
                                                       1.71006e-14, -0.816496580927726,-0.816496580927726, 
                                                       5.13019e-14, -0.816496580927726), ncol=3), tolerance = 2*myEps,scale = 1)  
  expect_equal(CreateEigenfncts(c(0,1,3)*(10^-14),2,2), matrix( c(-1, 0, -1,  3.1415e-14, -1, 9.42477e-14), nrow=2), tolerance = 2*myEps,scale = 1) 
})

test_that(" large magnitude 't' vector matches MATLAB output ", {  
  expect_equal(CreateEigenfncts(c(0,1.1,3)*(10^14),1*(10^15),1), 
                matrix( c(-0.447213595499958, -0.344583997682093, 0.138196601125010)*1.0e-07, nrow=1), tolerance = 2*myEps,scale = 1) 
  expect_equal(CreateEigenfncts(c(0,1.1,3)*(10^14),1*(10^15),2), 
               matrix( c( -0.447213595499958, 0, -0.344583997682093, 0.285064674313440, 
                          0.138196601125010, 0.425325404176020) *1.0e-07 , nrow=2), tolerance = 2*myEps,scale = 1) 
  expect_equal(CreateEigenfncts(c(0,1.1,3)*(10^14),1*(10^15),3), 
               matrix( c( -0.447213595499958, 0, -0.447213595499958, -0.344583997682093,
                          0.285064674313440, -0.083799471425391, 0.138196601125010, 
                          0.425325404176020, 0.361803398874990 )*1.0e-07, ncol=3), tolerance = 2*myEps,scale = 1) 
  expect_equal(CreateEigenfncts(c(0,1.1,3)*(10^14),3*(10^15),1), 
               matrix( c( -0.258198889747161, -0.251376991803109,-0.208887289734197 )*1.0e-07, nrow=1), tolerance = 2*myEps,scale = 1)  
  expect_equal(CreateEigenfncts(c(0,1.1,3)*(10^14),3*(10^15),2), 
               matrix( c(  -0.258198889747161, 0, -0.251376991803109, 0.058959941135370,
                           -0.208887289734197, 0.151765499551672)*1.0e-07, nrow=2), tolerance = 2*myEps,scale = 1) 
  expect_equal(CreateEigenfncts(c(0,1.1,3)*(10^14),3*(10^15),3), 
               matrix( c(-0.258198889747161, 0, -0.258198889747161, -0.251376991803109, 0.058959941135370,
                         -0.231271782027292, -0.208887289734197, 0.151765499551672,
                         -0.079787844860616)*1.0e-07, ncol=3), tolerance = 2*myEps,scale = 1)  
  expect_equal(CreateEigenfncts(c(0,1.1,3)*(10^14),2*(10^15),2), 
               matrix( c(-0.316227766016838, 0, -0.297532623654599, 0.107118335784358, 
                         -0.185874017230092, 0.255833636800846)*1.0e-07, nrow=2), tolerance = 2*myEps,scale = 1) 
})

test_that(" a lot of eigenfunctions p=25 matches MATLAB output ", { 
  expect_equal(CreateEigenfncts( seq(0,1, length.out=10), 5, 25), 
               matrix( c(-0.6324555320336759,0,-0.6324555320336759,0,-0.6324555320336759,0,-0.6324555320336759,0,-0.6324555320336759,0,-0.6324555320336759,0,-0.6324555320336759,0,-0.6324555320336759,0,-0.6324555320336759,0,-0.6324555320336759,0,-0.6324555320336759,0,-0.6324555320336759,0,-0.6324555320336759,
                         -0.6263005182719106,0.08802079761247468,-0.607955277328263,0.1743283705215958,-0.577776878450299,0.2572428399940965,-0.5363527098447583,0.3351503701955057,-0.4844890458342543,0.406534579668955,-0.4231953536447078,0.4700060559753786,-0.3536646452740472,0.524329399026206,-0.2772502568706986,0.56844726674084,-0.1954395075848548,0.6015009550075456,-0.1098247505930169,0.6228471113822249,-0.02207237975468798,0.6320702572119376,0.06610960484860623,0.6289908744542812,0.1530048411920833,
                         -0.607955277328263,0.1743283705215958,-0.5363527098447583,0.3351503701955057,-0.4231953536447078,0.4700060559753786,-0.2772502568706986,0.56844726674084,-0.1098247505930169,0.6228471113822249,0.06610960484860623,0.6289908744542812,0.2369220123421834,0.586402558033072,0.3893785059297271,0.4983817604205972,0.5116672736016927,0.3717480344601846,0.5943137964272708,0.2163125317132703,0.6309149021447457,0.04411786771463433,0.6186348612295627,-0.1314948990321669,0.558425089599446,
                         -0.577776878450299,0.2572428399940965,-0.4231953536447078,0.4700060559753786,-0.1954395075848548,0.6015009550075456,0.06610960484860623,0.6289908744542812,0.3162277660168378,0.5477225575051662,0.5116672736016927,0.3717480344601846,0.6186348612295626,0.1314948990321674,0.6186348612295627,-0.1314948990321669,0.5116672736016927,-0.3717480344601845,0.3162277660168382,-0.5477225575051661,0.06610960484860681,-0.628990874454281,-0.1954395075848547,-0.6015009550075458,-0.423195353644708,
                         -0.5363527098447583,0.3351503701955057,-0.2772502568706986,0.56844726674084,0.06610960484860623,0.6289908744542812,0.3893785059297271,0.4983817604205972,0.5943137964272708,0.2163125317132703,0.6186348612295627,-0.1314948990321669,0.45495043613618,-0.4393405292702913,0.1530048411920833,-0.6136688997918873,-0.1954395075848547,-0.6015009550075458,-0.4844890458342537,-0.4065345796689556,-0.6263005182719105,-0.08802079761247551,-0.5777768784502992,0.2572428399940963,-0.3536646452740471,
                         -0.4844890458342542,0.406534579668955,-0.1098247505930168,0.6228471113822249,0.3162277660168381,0.5477225575051661,0.5943137964272709,0.21631253171327,0.5943137964272709,-0.2163125317132701,0.3162277660168377,-0.5477225575051662,-0.1098247505930165,-0.6228471113822249,-0.4844890458342541,-0.4065345796689552,-0.6324555320336759,-1.549069285816155e-16,-0.4844890458342539,0.4065345796689554,-0.1098247505930168,0.6228471113822249,0.3162277660168384,0.5477225575051659,0.594313796427271,
                         -0.4231953536447078,0.4700060559753786,0.06610960484860623,0.6289908744542812,0.5116672736016927,0.3717480344601846,0.6186348612295627,-0.1314948990321669,0.3162277660168382,-0.5477225575051661,-0.1954395075848547,-0.6015009550075458,-0.5777768784502988,-0.257242839994097,-0.5777768784502992,0.2572428399940963,-0.195439507584855,0.6015009550075456,0.3162277660168374,0.5477225575051664,0.6186348612295625,0.131494899032168,0.511667273601693,-0.3717480344601843,0.06610960484860586,
                         -0.3536646452740472,0.524329399026206,0.2369220123421834,0.586402558033072,0.6186348612295626,0.1314948990321674,0.45495043613618,-0.4393405292702913,-0.1098247505930165,-0.6228471113822249,-0.5777768784502988,-0.257242839994097,-0.5363527098447581,0.335150370195506,-0.02207237975468827,0.6320702572119374,0.5116672736016926,0.3717480344601846,0.5943137964272711,-0.2163125317132694,0.153004841192084,-0.6136688997918871,-0.4231953536447071,-0.4700060559753793,-0.6263005182719105,
                         -0.2772502568706986,0.56844726674084,0.3893785059297271,0.4983817604205972,0.6186348612295627,-0.1314948990321669,0.1530048411920833,-0.6136688997918873,-0.4844890458342537,-0.4065345796689556,-0.5777768784502992,0.2572428399940963,-0.02207237975468827,0.6320702572119374,0.558425089599446,0.2969198870164319,0.511667273601693,-0.3717480344601843,-0.1098247505930152,-0.6228471113822252,-0.6079552773282626,-0.1743283705215974,-0.4231953536447083,0.4700060559753781,0.2369220123421838,
                         -0.1954395075848548,0.6015009550075456,0.5116672736016927,0.3717480344601846,0.5116672736016927,-0.3717480344601845,-0.1954395075848547,-0.6015009550075458,-0.6324555320336759,-1.549069285816155e-16,-0.195439507584855,0.6015009550075456,0.5116672736016926,0.3717480344601846,0.511667273601693,-0.3717480344601843,-0.1954395075848545,-0.6015009550075459,-0.6324555320336759,-3.09813857163231e-16,-0.1954395075848562,0.6015009550075452,0.5116672736016925,0.3717480344601848,0.511667273601693), nrow=25), tolerance = 2*myEps,scale = 1) 
})

# cat("Done")
